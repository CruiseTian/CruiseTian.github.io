<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><meta name="google-site-verification" content="PsyY2h1bJZcUBXjQu8-k2YGLONozWvYTOLTjZOo_dSE"><meta name="baidu-site-verification" content="gCCh5hCbNQ"><link rel="apple-touch-icon" sizes="180x180" href="/images/centercode-apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/centercode-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/centercode-16x16-next.png"><link rel="mask-icon" href="/images/center-logo.svg" color="#222"><meta name="google-site-verification" content="xAxsQJeaRdqSWpNFltJ-OyYYtDjAQPvVd6vT2uYc3IQ"><meta name="baidu-site-verification" content="wQZdm18ujS"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"www.cruisetian.top",root:"/",scheme:"Pisces",version:"7.7.2",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"bounceIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="前言 这是pytorch深度学习的第二篇，第一篇为pytorch搭建CNN网络实现MNIST数据集的图像分类 ，本篇将继续深入深度学习，介绍深度学习领域的经典神经网络——AlexNet，并利用pytorch自己动手搭建一个AlexNet来训练一个花分类的数据集。同时，本篇文章所有的代码都已上传github，欢迎大家star和fork。链接在此：begin-deep-learning Alex"><meta property="og:type" content="article"><meta property="og:title" content="pytorch搭建AlexNet并训练花分类数据集"><meta property="og:url" content="https://www.cruisetian.top/post/39d19253.html"><meta property="og:site_name" content="Cruise学习小站"><meta property="og:description" content="前言 这是pytorch深度学习的第二篇，第一篇为pytorch搭建CNN网络实现MNIST数据集的图像分类 ，本篇将继续深入深度学习，介绍深度学习领域的经典神经网络——AlexNet，并利用pytorch自己动手搭建一个AlexNet来训练一个花分类的数据集。同时，本篇文章所有的代码都已上传github，欢迎大家star和fork。链接在此：begin-deep-learning Alex"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://i.loli.net/2020/08/08/PgDERKBc1tuNhqo.jpg"><meta property="og:image" content="https://i.loli.net/2020/08/08/zoYCSUT7BtbEnWJ.jpg"><meta property="article:published_time" content="2020-08-07T17:06:36.000Z"><meta property="article:modified_time" content="2020-08-07T17:06:36.000Z"><meta property="article:author" content="CruiseTian"><meta property="article:tag" content="pytorch"><meta property="article:tag" content="深度学习"><meta property="article:tag" content="CNN"><meta property="article:tag" content="图像处理"><meta property="article:tag" content="AlexNet"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://i.loli.net/2020/08/08/PgDERKBc1tuNhqo.jpg"><link rel="canonical" href="https://www.cruisetian.top/post/39d19253.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>pytorch搭建AlexNet并训练花分类数据集 | Cruise学习小站</title><script>function sendPageView(){if(CONFIG.hostname===location.hostname){var e=localStorage.getItem("uid")||Math.random()+"."+Math.random();localStorage.setItem("uid",e),navigator.sendBeacon("https://www.google-analytics.com/collect",new URLSearchParams({v:1,tid:"UA-165353628-3",cid:e,t:"pageview",dp:encodeURIComponent(location.pathname)}))}}document.addEventListener("pjax:complete",sendPageView),sendPageView()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c8b8a4917f3246d719ffebbc1db58d4e";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><script async defer data-website-id="9b520c20-62dc-4064-9ef0-a2675f9e9c9a" src="https://umami.cruisetian.top/cruisetian.js"></script><link rel="alternate" href="/atom.xml" title="Cruise学习小站" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><a target="_blank" rel="noopener" href="https://github.com/CruiseTian" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Cruise学习小站</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Life is real, life is earnest.</h1></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a></li><li class="menu-item menu-item-commonweal"><a href="/404.html" rel="section"><i class="fa fa-fw fa-heartbeat"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.cruisetian.top/post/39d19253.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/header.jpg"><meta itemprop="name" content="CruiseTian"><meta itemprop="description" content="Just a blog, just for fun."></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Cruise学习小站"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">pytorch搭建AlexNet并训练花分类数据集</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-08-08 01:06:36" itemprop="dateCreated datePublished" datetime="2020-08-08T01:06:36+08:00">2020-08-08</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">深度学习</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/post/39d19253.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/post/39d19253.html" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>12k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>11 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="前言">前言</h2><p>这是<code>pytorch</code>深度学习的第二篇，第一篇为<strong><a target="_blank" rel="noopener" href="https://cruisetian.top/post/28e069b6.html">pytorch搭建CNN网络实现MNIST数据集的图像分类</a></strong> ，本篇将继续深入深度学习，介绍深度学习领域的经典神经网络——AlexNet，并利用<code>pytorch</code>自己动手搭建一个AlexNet来训练一个花分类的数据集。同时，本篇文章所有的代码都已上传github，欢迎大家star和fork。链接在此：<a target="_blank" rel="noopener" href="https://github.com/CruiseTian/begin-deep-learning">begin-deep-learning</a></p><h2 id="alexnet简介">AlexNet简介</h2><p>AlexNet是一个卷积神经网络，是2012年的ISLVRC 2012竞赛的冠军网络，由亚历克斯·克里泽夫斯基（Alex Krizhevsky）设计（这也是AlexNet名字的来源），也是自2012年以后，深度学习开始迅速发展。</p><h3 id="特点">特点</h3><ul><li>由于AlexNet的计算成本很高，所以AlexNet使用了GPU来加速训练，使得计算具有可行性</li><li>使用了<code>ReLU</code>激活函数，而之前大多使用的是<code>sigmoid</code>或者<code>tanh</code>函数作为激活函数，所以具有更好的训练性能，能更快速地收敛</li><li>使用了LRN局部响应归一化（这个目前还不太了解）</li><li>使用dropout随机失活神经元，减少过拟合</li></ul><span id="more"></span><h2 id="alexnet网络结构详解">AlexNet网络结构详解</h2><h3 id="alexnet结构图">AlexNet结构图</h3><p>首先先上结构图，这是后面一系列分析的来源：</p><figure><img src="http://figure.cruisetian.top/img/Snipaste_2020-08-07_00-27-04.jpg" alt="图源原论文ImageNet Classification with Deep Convolutional Neural Networks"><figcaption aria-hidden="true">图源原论文ImageNet Classification with Deep Convolutional Neural Networks</figcaption></figure><p>这里可以看到图有上下两部分，这是因为作者使用了两块GPU来训练（Training on Multiple GPUs），上下地结构是一样的，所以只看下面这一部分就好了。</p><h3 id="基本结构">基本结构</h3><p>从图中可以看出，该网络有5个卷积层（Conv）和三个全连接层（FC），前两个卷积层后面都跟有一个最大池化层（Max pooling），卷积层和全连接层之间也有一个池化层。接下来具体分析每一层。</p><h3 id="conv-1">Conv 1</h3><p>首先，从图中可以看出，输入的是<span class="math inline">\(224\times224\times3\)</span>的图像，卷积核大小为11（即kernel_size=11）步长（Stride）为4，输出为<span class="math inline">\(55\times55\times48\)</span>，即图像高度和宽度变为了55，通道数（channel）变为了48，所以使用了48个卷积核，根据公式<span class="math inline">\(n^{[l]}=\frac{n^{[l-1]}+2p-f}{s}+1\)</span> 可以得出2p=3，所以padding应该为（1，2），当然简单地设为2也是可以的，因为<code>pytorch</code>会自动舍去多余的部分，并不影响结果；所以，该层具体信息如下：</p><ul><li>输入：input_size = [224, 224, 3]</li><li>卷积层：<ul><li>in_channels：3</li><li>out_channels：48</li><li>kernel_size：11</li><li>stride：4</li><li>padding：2</li></ul></li><li>输出：output_size = [55, 55, 48]</li></ul><h3 id="maxpool-1">Maxpool 1</h3><p>该层为池化层，从图中可以看出原本Height为55的图像经过池化后变成了27，可以想到kernel_size为3，步长为2，看了很多代码，事实证明也确实是这么做的。</p><ul><li>输入：input_size = [55, 55, 48]</li><li>池化层：<ul><li>kernel_size：3</li><li>stride：2</li></ul></li><li>输出：output_size = [27, 27, 48]</li></ul><h3 id="conv-2">Conv 2</h3><p>与<a href="#Conv1">Conv 1</a>类似，通过看图和一些操作，我们可以得出我们想要的参数，下面类似，我都不再赘述，只是将参数列举出来。</p><ul><li>输入：input_size = [27, 27, 48]</li><li>卷积层：<ul><li>in_channels：48</li><li>out_channels：128</li><li>kernel_size：5</li><li>stride：1</li><li>padding：2</li></ul></li><li>输出：output_size = [27, 27, 128]</li></ul><h3 id="maxpool-2">Maxpool 2</h3><ul><li>输入：input_size = [27, 27, 128]</li><li>池化层：<ul><li>kernel_size：3</li><li>stride：2</li></ul></li><li>输出：output_size = [13, 13, 128]</li></ul><h3 id="conv-3">Conv 3</h3><p>接下来为三个连续的卷积层。</p><ul><li>输入：input_size = [13, 13, 128]</li><li>卷积层：<ul><li>in_channels：128</li><li>out_channels：192</li><li>kernel_size：3</li><li>stride：1</li><li>padding：1</li></ul></li><li>输出：output_size = [13, 13, 192]</li></ul><h3 id="conv-4">Conv 4</h3><ul><li>输入：input_size = [13, 13, 192]</li><li>卷积层：<ul><li>in_channels：192</li><li>out_channels：192</li><li>kernel_size：3</li><li>stride：1</li><li>padding：1</li></ul></li><li>输出：output_size = [13, 13, 192]</li></ul><h3 id="conv-5">Conv 5</h3><ul><li>输入：input_size = [13, 13, 192]</li><li>卷积层：<ul><li>in_channels：192</li><li>out_channels：128</li><li>kernel_size：3</li><li>stride：1</li><li>padding：1</li></ul></li><li>输出：output_size = [13, 13, 128]</li></ul><h3 id="maxpool-3">Maxpool 3</h3><ul><li>输入：input_size = [13, 13, 128]</li><li>池化层：<ul><li>kernel_size：3</li><li>stride：2</li></ul></li><li>输出：output_size = [6, 6, 128]</li></ul><p>经过第三个池化层以后，会将得到的[6, 6, 128]的<code>tensor</code>展开，然后与第一个全连接层相连</p><h3 id="fc-1-fc-2-fc-3">FC 1 、FC 2 、FC 3</h3><p>由图中可以看出，输入全连接层的参数为<span class="math display">\[128\times6\times6\]</span>,经过三个全连接层，最终输出为1000，实际上这个1000指的是分的类别数，即<code>num_classes</code>，所以三个全连接层的变换如下：</p><p><span class="math display">\[Maxpool3 \rightarrow 128\times6\times6 \rightarrow FC 1 \rightarrow 2048 \rightarrow FC 2 \rightarrow 2048 \rightarrow FC 3 \rightarrow 1000(num\_classes)\]</span></p><h2 id="代码实例分析">代码实例分析</h2><h3 id="数据集准备">数据集准备</h3><h4 id="下载">下载</h4><p>首先到如下网址下载数据集：</p><p>http://download.tensorflow.org/example_images/flower_photos.tgz</p><p>此数据集包含 5 中类型的花（雏菊daisy，蒲公英dandelion，玫瑰roses，向日葵sunflower，郁金香tulips），每种类型有600~900张图像不等。</p><h4 id="训练集和测试集划分">训练集和测试集划分</h4><p>首先新建flower_data文件夹，将下载的数据集移入flower_data文件夹下，然后解压数据集，之后回到上一层目录（即flower_data同级目录）新建一个<code>.py</code>文件用来写入脚本划分数据集，名称随意，例如我用的是<code>split_data.py</code>,打开该文件，写入如下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> shutil <span class="keyword">import</span> copy</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mkfile</span>(<span class="params">file</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(file):</span><br><span class="line">        os.makedirs(file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">file = <span class="string">&#x27;flower_data/flower_photos&#x27;</span></span><br><span class="line">flower_class = [cla <span class="keyword">for</span> cla <span class="keyword">in</span> os.listdir(file) <span class="keyword">if</span> <span class="string">&quot;.txt&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> cla]</span><br><span class="line">mkfile(<span class="string">&#x27;flower_data/train&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> cla <span class="keyword">in</span> flower_class:</span><br><span class="line">    mkfile(<span class="string">&#x27;flower_data/train/&#x27;</span>+cla)</span><br><span class="line"></span><br><span class="line">mkfile(<span class="string">&#x27;flower_data/val&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> cla <span class="keyword">in</span> flower_class:</span><br><span class="line">    mkfile(<span class="string">&#x27;flower_data/val/&#x27;</span>+cla)</span><br><span class="line"></span><br><span class="line">split_rate = <span class="number">0.1</span></span><br><span class="line"><span class="keyword">for</span> cla <span class="keyword">in</span> flower_class:</span><br><span class="line">    cla_path = file + <span class="string">&#x27;/&#x27;</span> + cla + <span class="string">&#x27;/&#x27;</span></span><br><span class="line">    images = os.listdir(cla_path)</span><br><span class="line">    num = <span class="built_in">len</span>(images)</span><br><span class="line">    eval_index = random.sample(images, k=<span class="built_in">int</span>(num*split_rate))</span><br><span class="line">    <span class="keyword">for</span> index, image <span class="keyword">in</span> <span class="built_in">enumerate</span>(images):</span><br><span class="line">        <span class="keyword">if</span> image <span class="keyword">in</span> eval_index:</span><br><span class="line">            image_path = cla_path + image</span><br><span class="line">            new_path = <span class="string">&#x27;flower_data/val/&#x27;</span> + cla</span><br><span class="line">            copy(image_path, new_path)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            image_path = cla_path + image</span><br><span class="line">            new_path = <span class="string">&#x27;flower_data/train/&#x27;</span> + cla</span><br><span class="line">            copy(image_path, new_path)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\r[&#123;&#125;] processing [&#123;&#125;/&#123;&#125;]&quot;</span>.<span class="built_in">format</span>(cla, index+<span class="number">1</span>, num), end=<span class="string">&quot;&quot;</span>)  <span class="comment"># processing bar</span></span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;processing done!&quot;</span>)</span><br></pre></td></tr></table></figure><p>此脚本将数据集按9：1的比例划分为训练集train和验证集val，然后运行该脚本进行划分。</p><p>最终得到的目录结构大致如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">|-- flower_data</span><br><span class="line">	|-- flower_photos</span><br><span class="line">		|-- daisy</span><br><span class="line">		|-- dandelion</span><br><span class="line">		|-- roses</span><br><span class="line">		|-- sunflowers</span><br><span class="line">		|-- tulips</span><br><span class="line">		|-- LICENSE.txt</span><br><span class="line">	|-- train</span><br><span class="line">		|-- daisy</span><br><span class="line">		|-- dandelion</span><br><span class="line">		|-- roses</span><br><span class="line">		|-- sunflowers</span><br><span class="line">		|-- tulips</span><br><span class="line">	|-- val</span><br><span class="line">		|-- daisy</span><br><span class="line">		|-- dandelion</span><br><span class="line">		|-- roses</span><br><span class="line">		|-- sunflowers</span><br><span class="line">		|-- tulips</span><br><span class="line">	|-- flower_photos.tgz</span><br><span class="line">|-- split_data.py</span><br></pre></td></tr></table></figure><h3 id="具体代码">具体代码</h3><h4 id="module.py">module.py</h4><p>首先为模型定义部分<code>module.py</code>,该部分定义了我们的网络结构AlexNet，即上面详解的部分，所以只需要将上面详解的部分转换为pytorch代码即可，比较简单，每一步pytorch都有专门的函数，所以调包就完事了。下面是具体代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlexNet</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_classes = <span class="number">1000</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(AlexNet, self).__init__()</span><br><span class="line">        <span class="comment"># 用nn.Sequential()将网络打包成一个模块，精简代码</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 卷积层提取图像特征</span></span><br><span class="line">        self.features = nn.Sequential(</span><br><span class="line">            <span class="comment"># Conv1: Input:[3,224,224] Output:[48,55,55]</span></span><br><span class="line">            nn.Conv2d(<span class="number">3</span>, <span class="number">48</span>, kernel_size=<span class="number">11</span>, stride=<span class="number">4</span>, padding=<span class="number">2</span>),</span><br><span class="line">            nn.ReLU(inplace=<span class="literal">True</span>),  <span class="comment"># inplace:直接覆盖原值，节省内存</span></span><br><span class="line">            <span class="comment"># Pool1:</span></span><br><span class="line">            nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>),  <span class="comment"># 池化，Output:[48,27,27]</span></span><br><span class="line">            <span class="comment"># Conv2: Input:[48,27,27] Output:[128,27,27]</span></span><br><span class="line">            nn.Conv2d(<span class="number">48</span>, <span class="number">128</span>, kernel_size=<span class="number">5</span>, stride=<span class="number">1</span>, padding=<span class="number">2</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line">            <span class="comment"># Pool2:</span></span><br><span class="line">            nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>),  <span class="comment">#Output:[128,13,13]</span></span><br><span class="line">            <span class="comment"># Conv3: Input:[128,13,13] Output:[192,13,13]</span></span><br><span class="line">            nn.Conv2d(<span class="number">128</span>, <span class="number">192</span>, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line">            <span class="comment"># Conv4: Input:[192,13,13] Output:[192,13,13]</span></span><br><span class="line">            nn.Conv2d(<span class="number">192</span>, <span class="number">192</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line">            <span class="comment"># Conv5: Input:[192,13,13] Output:[128,13,13]</span></span><br><span class="line">            nn.Conv2d(<span class="number">192</span>, <span class="number">128</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line">            <span class="comment"># Pool3:</span></span><br><span class="line">            nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>),  <span class="comment"># Output:[128,6,6]</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 全连接层对图像分类</span></span><br><span class="line">        self.classifier = nn.Sequential(</span><br><span class="line">            <span class="comment"># FC1</span></span><br><span class="line">            nn.Dropout(p=<span class="number">0.5</span>),  <span class="comment"># 随即失活，防止过拟合</span></span><br><span class="line">            nn.Linear(<span class="number">128</span>*<span class="number">6</span>*<span class="number">6</span>, <span class="number">2048</span>),  <span class="comment"># 相当于求Z = WX+b</span></span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line">            <span class="comment"># FC2</span></span><br><span class="line">            nn.Dropout(p=<span class="number">0.5</span>),</span><br><span class="line">            nn.Linear(<span class="number">2048</span>,<span class="number">2048</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line">            <span class="comment"># FC3</span></span><br><span class="line">            nn.Linear(<span class="number">2048</span>, num_classes),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        x = self.features(x)</span><br><span class="line">        x = torch.flatten(x, start_dim=<span class="number">1</span>)</span><br><span class="line">        x = self.classifier(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><h4 id="train.py">train.py</h4><p><code>train.py</code>为训练部分的代码，主要是加载和处理数据集，调用刚刚定义的模型进行训练，以及打印训练过程中的信息，使训练过程可视化。这里直接上代码，具体的解释都在注释里：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms, datasets, utils</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> module <span class="keyword">import</span> AlexNet</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">DEVICE = torch.device(<span class="string">&#x27;cuda&#x27;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&#x27;cpu&#x27;</span>)</span><br><span class="line">BATCH_SIZE = <span class="number">32</span></span><br><span class="line">EPOCH = <span class="number">10</span></span><br><span class="line">LR = <span class="number">0.0002</span></span><br><span class="line"><span class="built_in">print</span>(DEVICE)</span><br><span class="line"></span><br><span class="line">data_transform = &#123;</span><br><span class="line">    <span class="string">&quot;train&quot;</span>: transforms.Compose([transforms.RandomResizedCrop(<span class="number">224</span>),       <span class="comment"># 随机裁剪，再缩放成 224×224</span></span><br><span class="line">                                 transforms.RandomHorizontalFlip(p=<span class="number">0.5</span>),  <span class="comment"># 水平方向随机翻转，概率为 0.5, 即一半的概率翻转, 一半的概率不翻转</span></span><br><span class="line">                                 transforms.ToTensor(),</span><br><span class="line">                                 transforms.Normalize((<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>), (<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>))]),</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;val&quot;</span>: transforms.Compose([transforms.Resize((<span class="number">224</span>, <span class="number">224</span>)),  <span class="comment"># cannot 224, must (224, 224)</span></span><br><span class="line">                               transforms.ToTensor(),</span><br><span class="line">                               transforms.Normalize((<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>), (<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>))])&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据集处理及加载</span></span><br><span class="line"><span class="comment"># 获取图像数据集的路径</span></span><br><span class="line">data_root = os.path.abspath(os.path.join(os.getcwd(),<span class="string">&quot;..&quot;</span>))  		<span class="comment"># get data root path 返回上上层目录</span></span><br><span class="line">image_path = data_root + <span class="string">&quot;/data_set/flower_data/&quot;</span>  				 		<span class="comment"># flower data_set path</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入训练集并进行预处理</span></span><br><span class="line">train_dataset = datasets.ImageFolder(root=image_path + <span class="string">&quot;/train&quot;</span>,</span><br><span class="line">                                     transform=data_transform[<span class="string">&quot;train&quot;</span>])</span><br><span class="line">train_num = <span class="built_in">len</span>(train_dataset)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按batch_size分批次加载训练集</span></span><br><span class="line">train_loader = torch.utils.data.DataLoader(train_dataset,	<span class="comment"># 导入的训练集</span></span><br><span class="line">                                           batch_size=BATCH_SIZE, 	<span class="comment"># 每批训练的样本数</span></span><br><span class="line">                                           shuffle=<span class="literal">True</span>,	<span class="comment"># 是否打乱训练集</span></span><br><span class="line">                                           num_workers=<span class="number">0</span>)	<span class="comment"># 使用线程数，在windows下设置为0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入验证集并进行预处理</span></span><br><span class="line">validate_dataset = datasets.ImageFolder(root=image_path + <span class="string">&quot;/val&quot;</span>,</span><br><span class="line">                                        transform=data_transform[<span class="string">&quot;val&quot;</span>])</span><br><span class="line">val_num = <span class="built_in">len</span>(validate_dataset)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载验证集</span></span><br><span class="line">validate_loader = torch.utils.data.DataLoader(validate_dataset,	<span class="comment"># 导入的验证集</span></span><br><span class="line">                                              batch_size=BATCH_SIZE,</span><br><span class="line">                                              shuffle=<span class="literal">True</span>,</span><br><span class="line">                                              num_workers=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取分类的名称所对应的索引，即&#123;&#x27;daisy&#x27;:0, &#x27;dandelion&#x27;:1, &#x27;roses&#x27;:2, &#x27;sunflower&#x27;:3, &#x27;tulips&#x27;:4&#125;</span></span><br><span class="line">flower_list = train_dataset.class_to_idx</span><br><span class="line"><span class="comment"># 将 flower_list 中的 key 和 val 调换位置,使得预测之后返回的索引可以直接通过字典得到所属类别</span></span><br><span class="line">cla_dict = <span class="built_in">dict</span>((val, key) <span class="keyword">for</span> key, val <span class="keyword">in</span> flower_list.items())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 cla_dict 写入 json 文件中</span></span><br><span class="line">json_str = json.dumps(cla_dict, indent=<span class="number">4</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;class_indices.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> json_file:</span><br><span class="line">    json_file.write(json_str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">net = AlexNet(num_classes=<span class="number">5</span>)                          <span class="comment"># 实例化网络（输出类别为5）</span></span><br><span class="line">net.to(DEVICE)                                        <span class="comment"># 分配网络到指定的设备（GPU/CPU）训练</span></span><br><span class="line">loss_function = nn.CrossEntropyLoss()			 	  <span class="comment"># 交叉熵损失</span></span><br><span class="line">optimizer = optim.Adam(net.parameters(), lr=LR)	  <span class="comment"># 优化器（训练参数，学习率）</span></span><br><span class="line"></span><br><span class="line">save_path = <span class="string">&#x27;./AlexNet.pth&#x27;</span></span><br><span class="line">best_acc = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">train_counter = []</span><br><span class="line">train_losses = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span> (EPOCH):</span><br><span class="line">    <span class="comment">########################################## train ###############################################</span></span><br><span class="line">    net.train()                 <span class="comment"># 训练过程中开启 Dropout</span></span><br><span class="line">    running_loss = <span class="number">0.0</span>			<span class="comment"># 每个 epoch 都会对 running_loss 清零</span></span><br><span class="line">    time_start = time.perf_counter()	<span class="comment"># 对训练一个 epoch 计时</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> step, data <span class="keyword">in</span> <span class="built_in">enumerate</span>(train_loader, start=<span class="number">0</span>):  <span class="comment"># 遍历训练集，step从0开始计算</span></span><br><span class="line">        images, labels = data   <span class="comment"># 获取训练集的图像和标签</span></span><br><span class="line">        optimizer.zero_grad()	<span class="comment"># 清除历史梯度</span></span><br><span class="line"></span><br><span class="line">        outputs = net(images.to(DEVICE))				 <span class="comment"># 正向传播</span></span><br><span class="line">        loss = loss_function(outputs, labels.to(DEVICE)) <span class="comment"># 计算损失</span></span><br><span class="line">        loss.backward()								     <span class="comment"># 反向传播</span></span><br><span class="line">        optimizer.step()								 <span class="comment"># 优化器更新参数</span></span><br><span class="line">        running_loss += loss.item()</span><br><span class="line"></span><br><span class="line">        train_losses.append(loss.item())</span><br><span class="line">        train_counter.append((step*BATCH_SIZE) + ((epoch-<span class="number">1</span>)*<span class="built_in">len</span>(train_loader.dataset)))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 打印训练进度（使训练过程可视化）</span></span><br><span class="line">        rate = (step + <span class="number">1</span>) / <span class="built_in">len</span>(train_loader)           <span class="comment"># 当前进度 = 当前step / 训练一轮epoch所需总step</span></span><br><span class="line">        a = <span class="string">&quot;*&quot;</span> * <span class="built_in">int</span>(rate * <span class="number">50</span>)</span><br><span class="line">        b = <span class="string">&quot;.&quot;</span> * <span class="built_in">int</span>((<span class="number">1</span> - rate) * <span class="number">50</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\rtrain loss: &#123;:^3.0f&#125;%[&#123;&#125;-&gt;&#123;&#125;]&#123;:.3f&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(rate * <span class="number">100</span>), a, b, loss), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%f s&#x27;</span> % (time.perf_counter()-time_start))</span><br><span class="line"></span><br><span class="line">    <span class="comment">########################################## validate ###############################################</span></span><br><span class="line">    net.<span class="built_in">eval</span>()    <span class="comment"># 验证过程中关闭 Dropout</span></span><br><span class="line">    acc = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> val_data <span class="keyword">in</span> validate_loader:</span><br><span class="line">            val_images, val_labels = val_data</span><br><span class="line">            outputs = net(val_images.to(DEVICE))</span><br><span class="line">            predict_y = torch.<span class="built_in">max</span>(outputs, dim=<span class="number">1</span>)[<span class="number">1</span>] <span class="comment"># 以output中值最大位置对应的索引（标签）作为预测输出</span></span><br><span class="line">            acc += (predict_y == val_labels.to(DEVICE)).<span class="built_in">sum</span>().item()</span><br><span class="line">        val_accurate = acc/val_num</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 保存准确率最高的那次网络参数</span></span><br><span class="line">        <span class="keyword">if</span> val_accurate &gt; best_acc:</span><br><span class="line">            best_acc = val_accurate</span><br><span class="line">            torch.save(net.state_dict(), save_path)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[epoch %d] train_loss: %.3f  test_accuracy: %.3f \n&#x27;</span> %</span><br><span class="line">              (epoch + <span class="number">1</span>, running_loss / step, val_accurate))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Finished Training&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印训练过程中的loss变化情况</span></span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line">plt.plot(train_counter, train_losses, color=<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line">plt.legend(<span class="string">&#x27;Train Loss&#x27;</span>, loc=<span class="string">&#x27;upper right&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;number of training examples&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;loss&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h4 id="predict.py">predict.py</h4><p>该部分主要检验刚刚的训练成果，通过调用我们刚刚训练好的神经网络，对我们从网上随意下载的一张图片进行分类，并且给出对应的可能性，可以随意从网上下载一张五种花的图片，然后丢入模型进行预测就好了。具体代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> module <span class="keyword">import</span> AlexNet</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 预处理</span></span><br><span class="line">data_transform = transforms.Compose(</span><br><span class="line">    [transforms.Resize((<span class="number">224</span>, <span class="number">224</span>)),</span><br><span class="line">     transforms.ToTensor(),</span><br><span class="line">     transforms.Normalize((<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>), (<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>))])</span><br><span class="line"></span><br><span class="line"><span class="comment"># load image</span></span><br><span class="line">images = [<span class="string">&quot;tulips&quot;</span>, <span class="string">&quot;dandelion&quot;</span>, <span class="string">&quot;roses&quot;</span>, <span class="string">&quot;sunflower&quot;</span>, <span class="string">&quot;daisy&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> images:</span><br><span class="line">    img = Image.<span class="built_in">open</span>(<span class="string">&quot;predict/&quot;</span>+i+<span class="string">&quot;.jpg&quot;</span>)</span><br><span class="line">    plt.imshow(img)</span><br><span class="line">    <span class="comment"># plt.show()</span></span><br><span class="line">    <span class="comment"># [N, C, H, W]</span></span><br><span class="line">    img = data_transform(img)</span><br><span class="line">    <span class="comment"># expand batch dimension</span></span><br><span class="line">    img = torch.unsqueeze(img, dim=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># read class_indict</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        json_file = <span class="built_in">open</span>(<span class="string">&#x27;./class_indices.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">        class_indict = json.load(json_file)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        exit(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># create model</span></span><br><span class="line">    model = AlexNet(num_classes=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># load model weights</span></span><br><span class="line">    model_weight_path = <span class="string">&quot;./AlexNet.pth&quot;</span></span><br><span class="line">    model.load_state_dict(torch.load(model_weight_path))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 关闭 Dropout</span></span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="comment"># predict class</span></span><br><span class="line">        output = torch.squeeze(model(img))     <span class="comment"># 将输出压缩，即压缩掉 batch 这个维度</span></span><br><span class="line">        predict = torch.softmax(output, dim=<span class="number">0</span>)</span><br><span class="line">        predict_cla = torch.argmax(predict).numpy()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;origin: &quot;</span>+i+<span class="string">&quot;\tpredict: &quot;</span>+class_indict[<span class="built_in">str</span>(predict_cla)], <span class="string">&quot;\tProbability: &quot;</span>,predict[predict_cla].item())</span><br><span class="line">    <span class="comment">#plt.show()</span></span><br></pre></td></tr></table></figure><h2 id="结果展示">结果展示</h2><h4 id="训练过程展示">训练过程展示</h4><p><img data-src="https://i.loli.net/2020/08/08/PgDERKBc1tuNhqo.jpg"></p><p>可以看出，十个epoch已经可以训练出准确率高达70%的模型了，效果还是比较理想的。</p><h4 id="预测结果展示">预测结果展示</h4><p>我从Google上随意找了五类图片各一张，然后丢入模型进行预测，最终预测得到的结果如下：</p><p><img data-src="https://i.loli.net/2020/08/08/zoYCSUT7BtbEnWJ.jpg"></p><p>可以看出，所有图片均预测正确，而且可能性大多比较高，所以还是比较理想的。</p><h2 id="结语">结语</h2><p>至此，关于AlexNet的模型介绍详解和具体的图像分类都已经做完，这个过程中，我曾经尝试改变模型，使全连接层更加平缓地输出五个类别，而不是从2048直接变为5，但是发现准确率反而降低了，事实证明，还是原模型更好。另外，调参确实浪费时间且折磨人，但是看着模型一点点变好，训练出来的准确率一点点提高的喜悦和成就感也是无与伦比的，这玩意确实吸引人。接下来会研究另外一个深度学习的经典模型VGG，并做一些实际的应用，慢慢来吧，先打好基础，才能走得更稳，更远。</p></div><div><div><div style="text-align:center;color:#ccc;font-size:20px">------------- 本 文 结 束<i class="fa fa-paw"></i> 感 谢 您 的 阅 读 -------------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong> CruiseTian</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://www.cruisetian.top/post/39d19253.html" title="pytorch搭建AlexNet并训练花分类数据集">https://www.cruisetian.top/post/39d19253.html</a></li><li class="post-copyright-license"><strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/pytorch/" rel="tag"><i class="fa fa-tag"></i> pytorch</a><a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> 深度学习</a><a href="/tags/CNN/" rel="tag"><i class="fa fa-tag"></i> CNN</a><a href="/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" rel="tag"><i class="fa fa-tag"></i> 图像处理</a><a href="/tags/AlexNet/" rel="tag"><i class="fa fa-tag"></i> AlexNet</a></div><div class="post-nav"><div class="post-nav-item"><a href="/post/28e069b6.html" rel="prev" title="pytorch搭建CNN网络实现MNIST数据集的图像分类"><i class="fa fa-chevron-left"></i> pytorch搭建CNN网络实现MNIST数据集的图像分类</a></div><div class="post-nav-item"><a href="/post/eedc6243.html" rel="next" title="pytorch搭建VGG并训练花分类数据集">pytorch搭建VGG并训练花分类数据集<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments" id="valine-comments"></div><script>window.addEventListener("tabs:register",()=>{let t=CONFIG.comments.activeClass;if(CONFIG.comments.storage&&(t=localStorage.getItem("comments_active")||t),t){let e=document.querySelector(`a[href="#comment-${t}"]`);e&&e.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{if(!t.target.matches(".tabs-comment .tab-content .tab-pane"))return;let e=t.target.classList[1];localStorage.setItem("comments_active",e)})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#alexnet%E7%AE%80%E4%BB%8B"><span class="nav-number">2.</span> <span class="nav-text">AlexNet简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E7%82%B9"><span class="nav-number">2.1.</span> <span class="nav-text">特点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#alexnet%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84%E8%AF%A6%E8%A7%A3"><span class="nav-number">3.</span> <span class="nav-text">AlexNet网络结构详解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#alexnet%E7%BB%93%E6%9E%84%E5%9B%BE"><span class="nav-number">3.1.</span> <span class="nav-text">AlexNet结构图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="nav-number">3.2.</span> <span class="nav-text">基本结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#conv-1"><span class="nav-number">3.3.</span> <span class="nav-text">Conv 1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#maxpool-1"><span class="nav-number">3.4.</span> <span class="nav-text">Maxpool 1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#conv-2"><span class="nav-number">3.5.</span> <span class="nav-text">Conv 2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#maxpool-2"><span class="nav-number">3.6.</span> <span class="nav-text">Maxpool 2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#conv-3"><span class="nav-number">3.7.</span> <span class="nav-text">Conv 3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#conv-4"><span class="nav-number">3.8.</span> <span class="nav-text">Conv 4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#conv-5"><span class="nav-number">3.9.</span> <span class="nav-text">Conv 5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#maxpool-3"><span class="nav-number">3.10.</span> <span class="nav-text">Maxpool 3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fc-1-fc-2-fc-3"><span class="nav-number">3.11.</span> <span class="nav-text">FC 1 、FC 2 、FC 3</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E4%BE%8B%E5%88%86%E6%9E%90"><span class="nav-number">4.</span> <span class="nav-text">代码实例分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E9%9B%86%E5%87%86%E5%A4%87"><span class="nav-number">4.1.</span> <span class="nav-text">数据集准备</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD"><span class="nav-number">4.1.1.</span> <span class="nav-text">下载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%AD%E7%BB%83%E9%9B%86%E5%92%8C%E6%B5%8B%E8%AF%95%E9%9B%86%E5%88%92%E5%88%86"><span class="nav-number">4.1.2.</span> <span class="nav-text">训练集和测试集划分</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81"><span class="nav-number">4.2.</span> <span class="nav-text">具体代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#module.py"><span class="nav-number">4.2.1.</span> <span class="nav-text">module.py</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#train.py"><span class="nav-number">4.2.2.</span> <span class="nav-text">train.py</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#predict.py"><span class="nav-number">4.2.3.</span> <span class="nav-text">predict.py</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C%E5%B1%95%E7%A4%BA"><span class="nav-number">5.</span> <span class="nav-text">结果展示</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%AD%E7%BB%83%E8%BF%87%E7%A8%8B%E5%B1%95%E7%A4%BA"><span class="nav-number">5.0.1.</span> <span class="nav-text">训练过程展示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%84%E6%B5%8B%E7%BB%93%E6%9E%9C%E5%B1%95%E7%A4%BA"><span class="nav-number">5.0.2.</span> <span class="nav-text">预测结果展示</span></a></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E8%AF%AD"><span class="nav-number">6.</span> <span class="nav-text">结语</span></a></li></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="CruiseTian" src="/images/header.jpg"><p class="site-author-name" itemprop="name">CruiseTian</p><div class="site-description" itemprop="description">Just a blog, just for fun.</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">27</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">55</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a></span><span class="links-of-author-item"><a href="https://github.com/CruiseTian" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CruiseTian" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:CruiseTian2020@gmail.com" title="E-Mail → mailto:CruiseTian2020@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-fas fa-heartbeat"></i></span> <span class="author" itemprop="copyrightHolder">CruiseTian</span></div><div class="beian"><a href="http://beian.miit.gov.cn/" rel="noopener" target="_blank">豫ICP备20012221号</a> <span class="post-meta-divider">|</span> <img src="/images/beian_icon.png" style="display:inline-block;text-decoration:none;height:13px"> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41018402000482" rel="noopener" target="_blank">豫公网安备 41018402000482号</a></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none">访客数<span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span> 人次</span> <span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none">总访问量<span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span> 次</span></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script><script src="//cdn.jsdelivr.net/npm/animejs@3.1.0/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script><script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script>"undefined"==typeof MathJax?(window.MathJax={loader:{source:{"[tex]/amsCd":"[tex]/amscd","[tex]/AMScd":"[tex]/amscd"}},tex:{inlineMath:{"[+]":[["$","$"]]},tags:"ams"},options:{renderActions:{findScript:[10,e=>{document.querySelectorAll('script[type^="math/tex"]').forEach(t=>{const a=!!t.type.match(/; *mode=display/),n=new e.options.MathItem(t.textContent,e.inputJax[0],a),d=document.createTextNode("");t.parentNode.replaceChild(d,t),n.start={node:d,delim:"",n:0},n.end={node:d,delim:"",n:0},e.math.push(n)})},"",!1],insertedScript:[200,()=>{document.querySelectorAll("mjx-container").forEach(e=>{let t=e.parentNode;"li"===t.nodeName.toLowerCase()&&t.parentNode.classList.add("has-jax")})},"",!1]}}},function(){var e=document.createElement("script");e.src="//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js",e.defer=!0,document.head.appendChild(e)}()):(MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset())</script><script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script><script>window.addEventListener("load",()=>{quicklink({timeout:3e3,priority:!0,ignores:[i=>i.includes("#"),i=>"https://www.cruisetian.top/post/39d19253.html"==i]})})</script><script>NexT.utils.loadComments(document.querySelector("#valine-comments"),()=>{NexT.utils.getScript("//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js",()=>{var e=["nick","mail","link"],i="nick,mail";i=i.split(",").filter(i=>e.includes(i)),new Valine({el:"#valine-comments",verify:!1,notify:!1,appId:"3vDRCQyoJDAY9HitaW2vAC4e-MdYXbMMI",appKey:"LxQwMJqts9Rj1WMSunvqbzw2",placeholder:"ヾﾉ≧∀≦)o来啊，快活啊!",avatar:"mm",meta:i,pageSize:"10",visitor:!1,lang:"zh-cn",path:location.pathname,recordIP:!1,serverURLs:""})},window.Valine)})</script><script>!function(){var e=document.getElementsByTagName("time");if(0!==e.length){var t=document.getElementsByClassName("post-content");if(0!==t.length){var n=new Date(e[0].dateTime),a=Date.now(),i=parseInt(a-n);if(2592e6<i){var s=parseInt(i/864e5);t[0].insertAdjacentHTML("afterbegin",'<div class="note note-warning" style="font-size:0.9rem"><p><div class="h6">文章时效性提示</div><p>这是一篇发布于 '+s+" 天前的文章，部分信息可能已发生改变，请注意甄别。</p></p></div>")}}}}()</script></body></html><script src="/js/src/clicklove.js"></script>