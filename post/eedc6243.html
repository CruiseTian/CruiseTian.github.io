<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><meta name="google-site-verification" content="PsyY2h1bJZcUBXjQu8-k2YGLONozWvYTOLTjZOo_dSE"><meta name="baidu-site-verification" content="gCCh5hCbNQ"><link rel="apple-touch-icon" sizes="180x180" href="/images/centercode-apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/centercode-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/centercode-16x16-next.png"><link rel="mask-icon" href="/images/center-logo.svg" color="#222"><meta name="google-site-verification" content="xAxsQJeaRdqSWpNFltJ-OyYYtDjAQPvVd6vT2uYc3IQ"><meta name="baidu-site-verification" content="wQZdm18ujS"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"www.cruisetian.top",root:"/",scheme:"Pisces",version:"7.7.2",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"bounceIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="前言 这是pytorch深度学习的第三篇，第一篇为pytorch搭建CNN网络实现MNIST数据集的图像分类 ，第二篇为pytorch搭建AlexNet并训练花分类数据集,本篇将继续深入深度学习，介绍深度学习领域的经典神经网络——VGGNet，并利用pytorch自己动手搭建一个VGG-16网络来训练一个花分类的数据集。同时，本篇文章所有的代码都已上传github，欢迎大家star和fork。"><meta property="og:type" content="article"><meta property="og:title" content="pytorch搭建VGG并训练花分类数据集"><meta property="og:url" content="https://www.cruisetian.top/post/eedc6243.html"><meta property="og:site_name" content="Cruise学习小站"><meta property="og:description" content="前言 这是pytorch深度学习的第三篇，第一篇为pytorch搭建CNN网络实现MNIST数据集的图像分类 ，第二篇为pytorch搭建AlexNet并训练花分类数据集,本篇将继续深入深度学习，介绍深度学习领域的经典神经网络——VGGNet，并利用pytorch自己动手搭建一个VGG-16网络来训练一个花分类的数据集。同时，本篇文章所有的代码都已上传github，欢迎大家star和fork。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://figure.cruisetian.top/img/VGG_RF.png"><meta property="og:image" content="http://figure.cruisetian.top/img/VGG_data.png"><meta property="article:published_time" content="2020-08-12T19:17:01.000Z"><meta property="article:modified_time" content="2020-08-12T19:17:01.000Z"><meta property="article:author" content="CruiseTian"><meta property="article:tag" content="pytorch"><meta property="article:tag" content="深度学习"><meta property="article:tag" content="CNN"><meta property="article:tag" content="VGG"><meta property="article:tag" content="图像处理"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://figure.cruisetian.top/img/VGG_RF.png"><link rel="canonical" href="https://www.cruisetian.top/post/eedc6243.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>pytorch搭建VGG并训练花分类数据集 | Cruise学习小站</title><script>function sendPageView(){if(CONFIG.hostname===location.hostname){var e=localStorage.getItem("uid")||Math.random()+"."+Math.random();localStorage.setItem("uid",e),navigator.sendBeacon("https://www.google-analytics.com/collect",new URLSearchParams({v:1,tid:"UA-165353628-3",cid:e,t:"pageview",dp:encodeURIComponent(location.pathname)}))}}document.addEventListener("pjax:complete",sendPageView),sendPageView()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c8b8a4917f3246d719ffebbc1db58d4e";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><script async defer data-website-id="9b520c20-62dc-4064-9ef0-a2675f9e9c9a" src="https://umami.cruisetian.top/cruisetian.js"></script><link rel="alternate" href="/atom.xml" title="Cruise学习小站" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><a target="_blank" rel="noopener" href="https://github.com/CruiseTian" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Cruise学习小站</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Life is real, life is earnest.</h1></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a></li><li class="menu-item menu-item-commonweal"><a href="/404.html" rel="section"><i class="fa fa-fw fa-heartbeat"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.cruisetian.top/post/eedc6243.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/header.jpg"><meta itemprop="name" content="CruiseTian"><meta itemprop="description" content="Just a blog, just for fun."></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Cruise学习小站"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">pytorch搭建VGG并训练花分类数据集</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-08-13 03:17:01" itemprop="dateCreated datePublished" datetime="2020-08-13T03:17:01+08:00">2020-08-13</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">深度学习</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/post/eedc6243.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/post/eedc6243.html" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>5k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>5 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="前言">前言</h2><p>这是<code>pytorch</code>深度学习的第三篇，第一篇为<a target="_blank" rel="noopener" href="https://cruisetian.top/post/28e069b6.html">pytorch搭建CNN网络实现MNIST数据集的图像分类</a> ，第二篇为<a target="_blank" rel="noopener" href="https://cruisetian.top/post/39d19253.html">pytorch搭建AlexNet并训练花分类数据集</a>,本篇将继续深入深度学习，介绍深度学习领域的经典神经网络——VGGNet，并利用<code>pytorch</code>自己动手搭建一个VGG-16网络来训练一个花分类的数据集。同时，本篇文章所有的代码都已上传github，欢迎大家star和fork。链接在此：<a target="_blank" rel="noopener" href="https://github.com/CruiseTian/begin-deep-learning">begin-deep-learning</a></p><h2 id="vgg简介">VGG简介</h2><p>VGG 在2014年由牛津大学著名研究组 <strong>VGG</strong>（<strong>Visual Geometry Group</strong>）提出，斩获该年 ImageNet 竞赛中 Localization Task（定位任务）第一名和 Classification Task（分类任务）第二名。该模型的主要工作是证明了增加网络的深度能够在一定程度上影响网络最终的性能。VGG有常见的两种结构，分别是VGG16和VGG19，两者除了网络深度不一样，其本质并没有什么区别。其中VGG16包含了13个卷积层和3个全连层；VGG19包含了16个卷积层和3个全连层。</p><span id="more"></span><p>同时，VGG网络的一个创新点是通过堆叠多个小卷积核来替代大尺度卷积核，可以减少训练参数，同时能保证相同的感受野。例如，两个3x3步长为1的卷积核的叠加，其感受野相当与一个5x5的卷积核。但是采用堆积的小卷积核是优于大卷积核的，因为层数的增加，增加了网络的非线性，从而能让网络来学习更复杂的模型。并且小卷积核的参数更少，例如，假设使用3x3的卷积核，那么堆叠3次3x3的卷积网络的参数是<span class="math inline">\(3\times3^2C^2=27C^2\)</span>，而使用一个7x7的卷积核的参数是<span class="math inline">\(7^2C^2=49C^2\)</span>，这里的C是输入和输出的通道数。</p><h2 id="vgg网络的优缺点">VGG网络的优缺点</h2><p>优点：</p><ul><li>VGGNet的结构非常简洁，整个网络都使用了同样大小的卷积核尺寸（3x3）和最大池化尺寸（2x2）。</li><li>几个小卷积核（3x3）的组合比一个大卷积核（5x5或7x7）效果好：</li><li>验证了通过不断加深网络结构可以提升性能。</li></ul><p>缺点：</p><ul><li>VGG耗费更多计算资源，并且使用了更多的参数（这里不是3x3卷积的锅），导致更多的内存占用。其中绝大多数的参数都是来自于第一个全连接层。</li></ul><h2 id="感受野">感受野</h2><p>感受野是机器视觉领域的深度神经网络中的一个概念，用来表示网络内部的不同位置的神经元对原图像的感受范围的大小。神经元之所以无法对原始图像的所有信息进行感知，是因为在这些网络结构中普遍使用卷积层和pooling层，在层与层之间均为局部相连（通过sliding filter）。神经元感受野的值越大表示其能接触到的原始图像范围就越大，也意味着他可能蕴含更为全局、语义层次更高的特征；而值越小则表示其所包含的特征越趋向于局部和细节。因此感受野的值可以大致用来判断每一层的抽象层次。通俗一点说就是，<strong>输出feature map上的一个单元对应输入层上的区域大小。</strong></p><p><img data-src="http://figure.cruisetian.top/img/VGG_RF.png"></p><p>比如在上图中，输出层 layer3 中一个单元对应输入层 layer2 上区域大小为2×2（池化操作），对应输入层 layer1 上大小为5×5。</p><p>感受野的计算公式为：<span class="math display">\[F(i)=(F(i+1)−1)×Stride +Ksize\]</span></p><ul><li><span class="math inline">\(F(i)\)</span>为第<span class="math inline">\(i\)</span>层感受野</li><li><span class="math inline">\(Stride\)</span>为第<span class="math inline">\(i\)</span>层的步距</li><li><span class="math inline">\(Ksize\)</span>为卷积核或池化核尺寸(即kernel_size)</li></ul><p>比如，在上图中：</p><ul><li>Feature map: <span class="math inline">\(F(3)=1\)</span></li><li>Pool1：<span class="math inline">\(F(2)=(1−1)×2+2=2\)</span></li><li>Conv1: <span class="math inline">\(F(1)=(2−1)×2+3=5\)</span></li></ul><p>所以，在VGG网络中，可以通过堆叠三个<span class="math inline">\(3\times3\)</span>的小卷积核来代替一个<span class="math inline">\(7\times7\)</span>的大卷积核，从而让结构更加清楚，并减少参数数量。</p><h2 id="vgg网络结构">VGG网络结构</h2><p>VGG网络有多个版本，各个版本的网络结构大致相同，一般常用的是VGG-16模型，即下图中的D。VGG的网络结构如下图所示：</p><p><img data-src="http://figure.cruisetian.top/img/VGG_data.png"></p><p>从图中可以看出来，VGG网络十分的整齐与美观，都是在一定数量的卷积层后加最大池化层，最终接入全连接层，卷积核大小均为<span class="math inline">\(3\times3\)</span>，同时，经过计算可以发现，经过<span class="math inline">\(3\times3\)</span>卷积的特征矩阵的尺寸是不改变的：<span class="math inline">\(n^{[l]}=\frac{n^{[l-1]}+2p-f}{s}+1=\frac{n^{l-1}-3+2}{1}+1=n^{l-1}\)</span> .</p><h2 id="代码实例分析">代码实例分析</h2><h3 id="数据集">数据集</h3><p>数据集仍采用上次训练AlexNet的数据集，具体数据集的下载以及划分请参看上一篇<a target="_blank" rel="noopener" href="https://cruisetian.top/post/39d19253.html">pytorch搭建AlexNet并训练花分类数据集</a>。</p><h3 id="具体代码">具体代码</h3><p>因为一般常用的是VGG-16模型，所以这里就以VGG-16模型来编写代码，即上图中的<strong>D部分</strong>。</p><h4 id="module.py">module.py</h4><p>与上次AlexNet模型的代码结构差不多，也是分为卷积层和全连接层，按照上边的架构图一步步写出来就好了，看着上面的结构表来写模型真的没什么难度...下面是具体代码，有什么不懂的可以看注释。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VGG</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_classes = <span class="number">1000</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(VGG, self).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 卷积层提取图像特征</span></span><br><span class="line">        self.features = nn.Sequential(</span><br><span class="line">            <span class="comment"># conv3-64_1 Input:[3,224,224] Output:[64,224,224]</span></span><br><span class="line">            nn.Conv2d(<span class="number">3</span>, <span class="number">64</span>, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line">            <span class="comment"># conv3-64_2 Input:[64,224,224] Output:[64,224,224]</span></span><br><span class="line">            nn.Conv2d(<span class="number">64</span>, <span class="number">64</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line"></span><br><span class="line">            <span class="comment"># pool1 Output:[64,112,112]</span></span><br><span class="line">            nn.MaxPool2d(kernel_size=<span class="number">2</span>, stride=<span class="number">2</span>),</span><br><span class="line"></span><br><span class="line">            <span class="comment"># conv3-128_1 Input:[64,112,112] Output:[128,112,112]</span></span><br><span class="line">            nn.Conv2d(<span class="number">64</span>, <span class="number">128</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line">            <span class="comment"># conv3-128_2 Input:[128,112,112] Output:[128,112,112]</span></span><br><span class="line">            nn.Conv2d(<span class="number">128</span>, <span class="number">128</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line"></span><br><span class="line">            <span class="comment"># pool2 Output:[128,56,56]</span></span><br><span class="line">            nn.MaxPool2d(kernel_size=<span class="number">2</span>, stride=<span class="number">2</span>),</span><br><span class="line"></span><br><span class="line">            <span class="comment"># conv3-256_1 Input:[128,56,56] Output:[256,56,56]</span></span><br><span class="line">            nn.Conv2d(<span class="number">128</span>, <span class="number">256</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line">            <span class="comment"># conv3-256_2 Input:[256,56,56] Output:[256,56,56]</span></span><br><span class="line">            nn.Conv2d(<span class="number">256</span>, <span class="number">256</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line">            <span class="comment"># conv3-256_3 Input:[256,56,56] Output:[256,56,56]</span></span><br><span class="line">            nn.Conv2d(<span class="number">256</span>, <span class="number">256</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line"></span><br><span class="line">            <span class="comment"># pool3 Output:[256,28,28]</span></span><br><span class="line">            nn.MaxPool2d(kernel_size=<span class="number">2</span>, stride=<span class="number">2</span>),</span><br><span class="line"></span><br><span class="line">            <span class="comment"># conv3-512_1 Input:[256,28,28] Output:[512,28,28]</span></span><br><span class="line">            nn.Conv2d(<span class="number">256</span>, <span class="number">512</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line">            <span class="comment"># conv3-512_2 Input:[512,28,28] Output:[512,28,28]</span></span><br><span class="line">            nn.Conv2d(<span class="number">512</span>, <span class="number">512</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line">            <span class="comment"># conv3-512_3 Input:[512,28,28] Output:[512,28,28]</span></span><br><span class="line">            nn.Conv2d(<span class="number">512</span>, <span class="number">512</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line"></span><br><span class="line">            <span class="comment"># pool4 Output:[512,14,14]</span></span><br><span class="line">            nn.MaxPool2d(kernel_size=<span class="number">2</span>, stride=<span class="number">2</span>),</span><br><span class="line"></span><br><span class="line">            <span class="comment"># conv3-512_4 Input:[512,14,14] Output:[512,14,14]</span></span><br><span class="line">            nn.Conv2d(<span class="number">512</span>, <span class="number">512</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line">            <span class="comment"># conv3-512_5 Input:[512,14,14] Output:[512,14,14]</span></span><br><span class="line">            nn.Conv2d(<span class="number">512</span>, <span class="number">512</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line">            <span class="comment"># conv3-512_6 Input:[512,14,14] Output:[512,14,14]</span></span><br><span class="line">            nn.Conv2d(<span class="number">512</span>, <span class="number">512</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line"></span><br><span class="line">            <span class="comment"># pool5 Output:[512,7,7]</span></span><br><span class="line">            nn.MaxPool2d(kernel_size=<span class="number">2</span>, stride=<span class="number">2</span>),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 全连接层对图像分类</span></span><br><span class="line">        self.classifier = nn.Sequential(</span><br><span class="line">            <span class="comment"># FC1</span></span><br><span class="line">            nn.Dropout(p=<span class="number">0.5</span>),  <span class="comment"># 随即失活，防止过拟合</span></span><br><span class="line">            nn.Linear(<span class="number">512</span>*<span class="number">7</span>*<span class="number">7</span>, <span class="number">2048</span>),  <span class="comment"># 相当于求Z = WX+b</span></span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line">            <span class="comment"># FC2</span></span><br><span class="line">            nn.Dropout(p=<span class="number">0.5</span>),</span><br><span class="line">            nn.Linear(<span class="number">2048</span>, <span class="number">2048</span>),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>),</span><br><span class="line">            <span class="comment"># FC3</span></span><br><span class="line">            nn.Linear(<span class="number">2048</span>, num_classes),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        x = self.features(x)</span><br><span class="line">        x = torch.flatten(x, start_dim=<span class="number">1</span>)</span><br><span class="line">        x = self.classifier(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><h4 id="train.pypredict.py">train.py&amp;&amp;predict.py</h4><p>这部分代码跟上一个模型属实差别不大，就基本照抄，注意把模型名字换了就行，这里就不再赘述了。有需要的可以到我的GitHub去看，<a target="_blank" rel="noopener" href="https://github.com/CruiseTian/begin-deep-learning/blob/master/pytorch/VGG/train.py">train.py</a>，<a target="_blank" rel="noopener" href="https://github.com/CruiseTian/begin-deep-learning/blob/master/pytorch/VGG/predict.py">predict.py</a></p><h2 id="结果展示">结果展示</h2><h4 id="训练过程">训练过程</h4><p><img src="http://figure.cruisetian.top/img/Snipaste_2020-08-10_12-27-33.jpg"></p><p>这里解释一下只显示10个epoch的原因是我之前训过30个epoch，但是最高准确率只达到0.797，所以我又多训了10个epoch，看看有没有什么提升，结果升到了0.813，所以我就把我训到的最好的结果放出来了，但是可以明显看出，VGG网络的分类准确率是比AlexNet更高的，已经达到了80%，提高了将近10个百分点，还是比较明显的提升。</p><h4 id="预测过程">预测过程</h4><p>同样的，使用的是跟上一次AlexNet一样的预测脚本和预测图片，下面是结果：</p><p><img src="http://figure.cruisetian.top/img/Snipaste_2020-08-09_19-59-39.jpg"></p><p>AlexNet的预测结果：</p><p><img src="http://figure.cruisetian.top/img/zoYCSUT7BtbEnWJ.jpg"></p><p>通过与AlexNet的预测结果的对比可以看出VGG网络的预测准确率确实比AlexNet要好，只不过参数更多，训练起来更麻烦，更耗时。</p><h2 id="总结与提升">总结与提升</h2><p>写完自己的VGG-16以后，又去拜读了pytorch官方对于VGGNet的实现，一下子确实感受到了差距，我自己实现的VGG-16就只是按照模型按部就班一步一步写出来，而pytorch官方则将VGG网络的多种网络结构（VGG-11,VGG-13...）统一成一个模型，代码也简洁的多，我当时自己实现的时候还觉得把每一步都写出来好像有点憨，读了pytorch的源码之后才发现确实有更好的写法，所以看来以后还是要提升写代码的水平，多读一些大佬的代码，提升业务水平才重要。有兴趣的可以亲自去看一看pytorch关于vgg实现的源码，这里给一个链接。<a target="_blank" rel="noopener" href="https://github.com/pytorch/vision/blob/master/torchvision/models/vgg.py">vgg.py</a></p></div><div><div><div style="text-align:center;color:#ccc;font-size:20px">------------- 本 文 结 束<i class="fa fa-paw"></i> 感 谢 您 的 阅 读 -------------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong> CruiseTian</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://www.cruisetian.top/post/eedc6243.html" title="pytorch搭建VGG并训练花分类数据集">https://www.cruisetian.top/post/eedc6243.html</a></li><li class="post-copyright-license"><strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/pytorch/" rel="tag"><i class="fa fa-tag"></i> pytorch</a><a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> 深度学习</a><a href="/tags/CNN/" rel="tag"><i class="fa fa-tag"></i> CNN</a><a href="/tags/VGG/" rel="tag"><i class="fa fa-tag"></i> VGG</a><a href="/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" rel="tag"><i class="fa fa-tag"></i> 图像处理</a></div><div class="post-nav"><div class="post-nav-item"><a href="/post/39d19253.html" rel="prev" title="pytorch搭建AlexNet并训练花分类数据集"><i class="fa fa-chevron-left"></i> pytorch搭建AlexNet并训练花分类数据集</a></div><div class="post-nav-item"><a href="/post/4050cd22.html" rel="next" title="Windows potplayer设置">Windows potplayer设置<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments" id="valine-comments"></div><script>window.addEventListener("tabs:register",()=>{let t=CONFIG.comments.activeClass;if(CONFIG.comments.storage&&(t=localStorage.getItem("comments_active")||t),t){let e=document.querySelector(`a[href="#comment-${t}"]`);e&&e.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{if(!t.target.matches(".tabs-comment .tab-content .tab-pane"))return;let e=t.target.classList[1];localStorage.setItem("comments_active",e)})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vgg%E7%AE%80%E4%BB%8B"><span class="nav-number">2.</span> <span class="nav-text">VGG简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vgg%E7%BD%91%E7%BB%9C%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="nav-number">3.</span> <span class="nav-text">VGG网络的优缺点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%84%9F%E5%8F%97%E9%87%8E"><span class="nav-number">4.</span> <span class="nav-text">感受野</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vgg%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84"><span class="nav-number">5.</span> <span class="nav-text">VGG网络结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E4%BE%8B%E5%88%86%E6%9E%90"><span class="nav-number">6.</span> <span class="nav-text">代码实例分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="nav-number">6.1.</span> <span class="nav-text">数据集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81"><span class="nav-number">6.2.</span> <span class="nav-text">具体代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#module.py"><span class="nav-number">6.2.1.</span> <span class="nav-text">module.py</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#train.pypredict.py"><span class="nav-number">6.2.2.</span> <span class="nav-text">train.py&amp;&amp;predict.py</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C%E5%B1%95%E7%A4%BA"><span class="nav-number">7.</span> <span class="nav-text">结果展示</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%AD%E7%BB%83%E8%BF%87%E7%A8%8B"><span class="nav-number">7.0.1.</span> <span class="nav-text">训练过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%84%E6%B5%8B%E8%BF%87%E7%A8%8B"><span class="nav-number">7.0.2.</span> <span class="nav-text">预测过程</span></a></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E6%8F%90%E5%8D%87"><span class="nav-number">8.</span> <span class="nav-text">总结与提升</span></a></li></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="CruiseTian" src="/images/header.jpg"><p class="site-author-name" itemprop="name">CruiseTian</p><div class="site-description" itemprop="description">Just a blog, just for fun.</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">27</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">55</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a></span><span class="links-of-author-item"><a href="https://github.com/CruiseTian" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CruiseTian" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:CruiseTian2020@gmail.com" title="E-Mail → mailto:CruiseTian2020@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-fas fa-heartbeat"></i></span> <span class="author" itemprop="copyrightHolder">CruiseTian</span></div><div class="beian"><a href="http://beian.miit.gov.cn/" rel="noopener" target="_blank">豫ICP备20012221号</a> <span class="post-meta-divider">|</span> <img src="/images/beian_icon.png" style="display:inline-block;text-decoration:none;height:13px"> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41018402000482" rel="noopener" target="_blank">豫公网安备 41018402000482号</a></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none">访客数<span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span> 人次</span> <span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none">总访问量<span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span> 次</span></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script><script src="//cdn.jsdelivr.net/npm/animejs@3.1.0/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script><script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script>"undefined"==typeof MathJax?(window.MathJax={loader:{source:{"[tex]/amsCd":"[tex]/amscd","[tex]/AMScd":"[tex]/amscd"}},tex:{inlineMath:{"[+]":[["$","$"]]},tags:"ams"},options:{renderActions:{findScript:[10,e=>{document.querySelectorAll('script[type^="math/tex"]').forEach(t=>{const a=!!t.type.match(/; *mode=display/),n=new e.options.MathItem(t.textContent,e.inputJax[0],a),d=document.createTextNode("");t.parentNode.replaceChild(d,t),n.start={node:d,delim:"",n:0},n.end={node:d,delim:"",n:0},e.math.push(n)})},"",!1],insertedScript:[200,()=>{document.querySelectorAll("mjx-container").forEach(e=>{let t=e.parentNode;"li"===t.nodeName.toLowerCase()&&t.parentNode.classList.add("has-jax")})},"",!1]}}},function(){var e=document.createElement("script");e.src="//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js",e.defer=!0,document.head.appendChild(e)}()):(MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset())</script><script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script><script>window.addEventListener("load",()=>{quicklink({timeout:3e3,priority:!0,ignores:[i=>i.includes("#"),i=>"https://www.cruisetian.top/post/eedc6243.html"==i]})})</script><script>NexT.utils.loadComments(document.querySelector("#valine-comments"),()=>{NexT.utils.getScript("//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js",()=>{var e=["nick","mail","link"],i="nick,mail";i=i.split(",").filter(i=>e.includes(i)),new Valine({el:"#valine-comments",verify:!1,notify:!1,appId:"3vDRCQyoJDAY9HitaW2vAC4e-MdYXbMMI",appKey:"LxQwMJqts9Rj1WMSunvqbzw2",placeholder:"ヾﾉ≧∀≦)o来啊，快活啊!",avatar:"mm",meta:i,pageSize:"10",visitor:!1,lang:"zh-cn",path:location.pathname,recordIP:!1,serverURLs:""})},window.Valine)})</script><script>!function(){var e=document.getElementsByTagName("time");if(0!==e.length){var t=document.getElementsByClassName("post-content");if(0!==t.length){var n=new Date(e[0].dateTime),a=Date.now(),i=parseInt(a-n);if(2592e6<i){var s=parseInt(i/864e5);t[0].insertAdjacentHTML("afterbegin",'<div class="note note-warning" style="font-size:0.9rem"><p><div class="h6">文章时效性提示</div><p>这是一篇发布于 '+s+" 天前的文章，部分信息可能已发生改变，请注意甄别。</p></p></div>")}}}}()</script></body></html><script src="/js/src/clicklove.js"></script>